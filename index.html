<!-- Updated index.html with Google Identity Services integration -->
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Reservas Temporarias</title>
<!-- Google APIs -->
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
<style>
/*  CSS same as previous (omitted for brevity) */
</style>
</head>
<body>
<div class="header">
  <button class="property-btn active" id="btnBeltran" onclick="switchCalendar('beltran')">Beltrán 4º</button>
  <button class="property-btn" id="btnBeltran8" onclick="switchCalendar('beltran8')">Beltrán 8º</button>
  <button class="property-btn" id="btnDirectorio8" onclick="switchCalendar('directorio8')">Directorio 8º</button>
  <span class="month-label" id="currentMonth">Julio 2025</span>
  <button class="action-btn" onclick="changeMonth(-1)">«</button>
  <button class="action-btn" onclick="changeMonth(1)">»</button>
  <button class="action-btn" onclick="openModal()">Añadir reserva</button>
  <button id="authBtn" class="action-btn secondary" onclick="handleAuthClick()" disabled>Iniciar sesión Google</button>
  <button id="signoutBtn" class="action-btn secondary hidden" onclick="handleSignoutClick()">Cerrar sesión</button>
</div>

<!-- Calendarios y modal (omitidos para brevedad) -->

<script>
/***** Google Drive Integration with GIS *****/
const CLIENT_ID = '698390297082-afegco16qaslcs1va27jk1bt8davfu9k.apps.googleusercontent.com';
const API_KEY   = 'AIzaSyBhdQaa0zSGFnZclfl6ZQQsrPi3GXeBrrw';
const FILE_ID   = '1hLYO3OsFwXizfAoKXwVyNsf8Otj0b1Tn';
const SCOPES    = 'https://www.googleapis.com/auth/drive';
const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];

let tokenClient;
let gapiInited = false;
let gisInited = false;

function gapiLoaded(){
  gapi.load('client', initializeGapiClient);
}
async function initializeGapiClient(){
  await gapi.client.init({ apiKey: API_KEY, discoveryDocs: DISCOVERY_DOCS });
  gapiInited = true;
  maybeEnableButtons();
}
function gisLoaded(){
  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    callback: (tokenResponse)=>{
      if(tokenResponse.error){ console.error(tokenResponse); return; }
      gapi.client.setToken(tokenResponse);
      updateSigninStatus(true);
      readData();
    }
  });
  gisInited = true;
  maybeEnableButtons();
}
function maybeEnableButtons(){
  if(gapiInited && gisInited){ document.getElementById('authBtn').disabled = false; }
}
function updateSigninStatus(isSignedIn){
  document.getElementById('authBtn').classList.toggle('hidden', isSignedIn);
  document.getElementById('signoutBtn').classList.toggle('hidden', !isSignedIn);
}
function handleAuthClick(){
  tokenClient.requestAccessToken({prompt:'consent'});
}
function handleSignoutClick(){
  const token = gapi.client.getToken();
  if(token){ google.accounts.oauth2.revoke(token.access_token, ()=>{}); gapi.client.setToken(''); }
  updateSigninStatus(false);
}

/***** Resto del JS (carga, guardado, UI) permanece igual que antes *****/

let reservas = [];
function readData(){
  if(!gapiInited) return;
  gapi.client.drive.files.get({fileId: FILE_ID, alt:'media'})
    .then(r=>{ reservas = Array.isArray(r.result)? r.result : []; renderAll(); })
    .catch(err=>{ console.error('Error al leer archivo',err); });
}
function saveReservaData(){
  if(!gapiInited) return;
  const content = JSON.stringify(reservas);
  gapi.client.request({
    path:`/upload/drive/v3/files/${FILE_ID}`,
    method:'PATCH',
    params:{uploadType:'media'},
    body:content
  }).then(()=>console.log('Reservas guardadas en Drive'))
    .catch(err=>console.error('Error al guardar',err));
}
</script>
<script>
/* resto de tu lógica de calendario, modal, etc. (omitida por brevedad) */
</script>
</body>
</html>
